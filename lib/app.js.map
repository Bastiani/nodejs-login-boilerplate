{"version":3,"sources":["../src/app.js"],"names":["loaders","app","Koa","router","Router","graphqlSettingsPerReq","req","console","log","dataloaders","user","header","authorization","graphiql","process","env","NODE_ENV","schema","pretty","context","extensions","document","variables","operationName","result","formatError","error","message","locations","stack","graphqlServer","use","all","endpoint","routes","allowedMethods"],"mappings":";;;;;;AAEA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;AACA;;AAEA;;;;AACA;;IAAYA,O;;AACZ;;;;;;AAXA;AAaA,MAAMC,MAAM,IAAIC,aAAJ,EAAZ;AACA,MAAMC,SAAS,IAAIC,mBAAJ,EAAf;;AAEA,MAAMC,wBAAwB,MAAMC,GAAN,IAAa;AACzCC,UAAQC,GAAR,CAAY,sCAAZ,EAAoDR,OAApD;;AAEA,QAAMS,cAAc,MAAM,4BAAeT,OAAf,CAA1B;AACAO,UAAQC,GAAR,CAAY,uCAAZ,EAAqDC,WAArD;;AAEA,QAAM,EAAEC,IAAF,KAAW,MAAM,qBAAQJ,IAAIK,MAAJ,CAAWC,aAAnB,EAAkCH,WAAlC,CAAvB;;AAEA,SAAO;AACLI,cAAUC,QAAQC,GAAR,CAAYC,QAAZ,KAAyB,YAD9B;AAELC,4BAFK;AAGLC,YAAQ,IAHH;AAILC,aAAS;AACPT,UADO;AAEPJ,SAFO;AAGPG;AAHO,KAJJ;AASLW,gBAAY,CAAC,EAAEC,QAAF,EAAYC,SAAZ,EAAuBC,aAAvB,EAAsCC,MAAtC,EAAD,KAAoD;AAC9DjB,cAAQC,GAAR,CAAY,qBAAMa,QAAN,CAAZ;AACAd,cAAQC,GAAR,CAAYc,SAAZ;AACAf,cAAQC,GAAR,CAAYgB,MAAZ;AACD,KAbI;AAcLC,iBAAaC,SAAS;AACpBnB,cAAQC,GAAR,CAAYkB,MAAMC,OAAlB;AACApB,cAAQC,GAAR,CAAYkB,MAAME,SAAlB;AACArB,cAAQC,GAAR,CAAYkB,MAAMG,KAAlB;;AAEA,aAAO;AACLF,iBAASD,MAAMC,OADV;AAELC,mBAAWF,MAAME,SAFZ;AAGLC,eAAOH,MAAMG;AAHR,OAAP;AAKD;AAxBI,GAAP;AA0BD,CAlCD;;AAoCA,MAAMC,gBAAgB,0BAAQ,0BAAYzB,qBAAZ,CAAR,CAAtB;;AAEAJ,IAAI8B,GAAJ,CAAQ,wBAAR;;AAEA5B,OAAO6B,GAAP,CAAW,UAAX,EAAuBF,aAAvB;AACA3B,OAAO6B,GAAP,CACE,aADF,EAEE,gDAAc;AACZC,YAAU;AADE,CAAd,CAFF;;AAOAhC,IAAI8B,GAAJ,CAAQ5B,OAAO+B,MAAP,EAAR,EAAyBH,GAAzB,CAA6B5B,OAAOgC,cAAP,EAA7B;;kBAEelC,G","file":"app.js","sourcesContent":["// @flow\n/* eslint-disable no-console */\nimport Koa from 'koa';\nimport Router from 'koa-router';\nimport graphqlHttp from 'koa-graphql';\nimport cors from 'koa-cors';\nimport convert from 'koa-convert';\nimport { print } from 'graphql/language';\nimport { koaPlayground } from 'graphql-playground-middleware';\n\nimport schema from './schema';\nimport * as loaders from './graphql/loader';\nimport { getUser, getDataloaders } from './helper';\n\nconst app = new Koa();\nconst router = new Router();\n\nconst graphqlSettingsPerReq = async req => {\n  console.log('=======================>>>>>> loader', loaders);\n\n  const dataloaders = await getDataloaders(loaders);\n  console.log('====================>>>>> dataloaders', dataloaders);\n\n  const { user } = await getUser(req.header.authorization, dataloaders);\n\n  return {\n    graphiql: process.env.NODE_ENV !== 'production',\n    schema,\n    pretty: true,\n    context: {\n      user,\n      req,\n      dataloaders,\n    },\n    extensions: ({ document, variables, operationName, result }) => {\n      console.log(print(document));\n      console.log(variables);\n      console.log(result);\n    },\n    formatError: error => {\n      console.log(error.message);\n      console.log(error.locations);\n      console.log(error.stack);\n\n      return {\n        message: error.message,\n        locations: error.locations,\n        stack: error.stack,\n      };\n    },\n  };\n};\n\nconst graphqlServer = convert(graphqlHttp(graphqlSettingsPerReq));\n\napp.use(cors());\n\nrouter.all('/graphql', graphqlServer);\nrouter.all(\n  '/playground',\n  koaPlayground({\n    endpoint: '/graphql',\n  }),\n);\n\napp.use(router.routes()).use(router.allowedMethods());\n\nexport default app;\n"]}